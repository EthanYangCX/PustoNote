操作系统

операционная система, operating system, sistema operativo, système d'exploitation, オペレーティングシステム, ระบบปฏิบัติการ, Betriebssystem, hệ điều hành, 운영 체제（運營 體制）

# 章一 操系概述

- 操系の作用
    - 位置
    - 用户视角
        - 服务
        - 用户界面：命令、GUI、系调
            - 系统调用の过程
            - 系调の类型：进程控制、文件管理、设备管理、信息维护、通信、保护
        - 不同用户不同需求
    - 系统视角：资源分配器。有效而公平。
        - 资源类别：CPU时间、内存空间、IO设备、文件存储空间
- 操系의发展过程
    - 人工操作方式
    - 单道批处理阶段：出现了监督程序，常驻内存，OSの雏形。联机批处理、脱机批处理
    - 多道批处理阶段
    - 分时系统
    - 实时操作系统
    - 批处理、分时、实时は三种基本なOS类型
- 操系の主要功能
    - 定义
    - 目标
    - 基本功能：
        - 处理机管理：进程控制、进程同步、进程通信、调度（作业调度、进程调度）
        - 存储管理：内存分配、内存保护、地址映射、内存扩充（逻）
        - 设备管理：设备分配、缓冲管理、设备处理
        - 文件管理（软件资源管理）（文件系统）：文件存储空间管理、目录管理、读写和存取控制
- 操系の基本特性
    - 并发
        - 并行乄并发
    - 共享
        - 方式：互斥共享方式、同时访问方式
    - 虚拟：一个物理实体映射为若干逻辑实体
    - 异步
- 计算机硬件简介
    - 总线
    - 现代计算机系统工作模式——冯诺依曼体系结构
    - 处理机的状态：区分OS代码和用户定义代码の执行
        - 系统中两类程序：用户程序、管理程序
        - CPU中增加一个模式位表示当前模式
            - 内核模式か管理模式か处理机的特权级：此状态下处理机可以使用全部指令、全部系统资源
                - linux区分管理模式，特权少于内核
            - 用户模式
        - 处理机状态の转换
            - 用户→内核：唯一途径は中断
            - 内核→用户：可通过设置PSW（程序状态字，在CPU中）
        - 特权指令：能引起伤害的机器指令
            - 可执行的功能：允许和禁止中断、进程切换、操作对主存进行保护的寄存器、IO控制、定时器管理
    - 存储器：主要指内存/主存（main memory）。操作系统本身也要放到主存运行
        - の类型
            - 读写型存储器か随机访问存储器（RAM）
            - 只读型存储器（ROM）
                - 变型：PROM、EPROM、EEPROM、闪存（flash memory）（必须按块擦除）
        - 의层次结构
        - 存储访问局部性原理：提高存储系统效能关键点
    - 时钟
        - 绝对时钟（记录当前时间）、间隔时钟（通过时钟寄存器，到时触发时钟中断）
    - 中断技术：操作系统是由中断驱动的
        - 概念：CPU对系统中或外发生的异步事件的响应
        - 目的
        - 特点：随机、自动处理
        - 中断类型
            - 按中断功能分类
            - 按中断方式分类
            - 按中断来源分类
        - 中断系统
        - 中断装置の基本功能
        - 中断寄存器
        - 发现中断
        - 中断响应
        - 中断向量表
        - 中断优先级
        - 中断屏蔽
        - 中断处理一般过程
        - 多个中断の处理
        - 典型的中断处理
            - IO中断
            - 时钟中断
            - 硬件故障中断
            - 程序性中断
            - 系统服务请求（自愿性中断）

# 章二 进程管理

# 章三 进程同步

# 章四 死锁

# 章五 内存管理

- 5.1 概述
    - 内存保护：`基址寄存器`、`界限寄存器`
    - `地址绑定`：每次都是从一个地址空间到另な映
        - 编译时绑定、加载时绑定、执行时绑定
    - 逻辑地址与物理地址
        - `逻辑地址`か`虚拟地址`：CPU所生
        - `物理地址`：内存单元所见（加载到内存地址寄存器）
    - `内存管理单元`（`MMU`）：逻辑地址を物理地址に。程序不见物址，引用时与基址寄存器（`重定位寄存器`）相加方可定位。
    - `动态加载`：所有程序以可重定位加载格式存于磁盘，主程序先加载到内存，其他模块在需要时再用`可重定位链接程序`加载，并更新程序的地址表。
    - `交换`（swap）：内存空间不够时进程从内存交换到外存。耗时。
        - 可以选择换出后继续让缓冲区和IO交换数据（让设备控制器来控制），但缓冲区和进程内存以及进程自己的处理一定不能用了
- 5.2 连续内存分配：早期方案，已弃
    - 两个分区（partition）——`操作系统区`、`用户进程区`，每进程は连续な内存区域を
    - 按分区划分方式分类：
        - 固定分区：内存划为多个固定分区，可同大或不，每は一进程。
            - 在作业大小と频率已知时合适
        - 可变分区：建进程时按需分区。OS管 `已分配分区表`と`空闲分区表`（空闲区链表）
            - 事先设定阈值，某空闲区减申请小于阈值则整个分给。以免外部碎片を。
            - 空闲区搜索算法と碎片问题
                - `首次适应法`（first-fit）：第一个足够大空闲区。可从链表头开始找也可以从上次结束の下位（循环首次适应法）
                - `最佳适应法`（best-fit）：满足な最小な空闲区。
                - `最差适应法`（worst-fit）：最大な空闲区
                - 三种策略比较：首、佳的空间利用和执行时间更好，首比佳快
                - 碎片问题：外部碎片、内部碎片（分配到多余实际需求）
                - 解决碎片：紧缩（定期压缩）、阈值（减外增内）、允址不连（分段か页管理）
- 5.3 分段（segmentation）：支持按段的用户视图的内存管理方案。每个段连续内存，逻辑地址空间为一组段
    - 段：按程序自身逻辑关系划为几段
        - C/C++ 编译的程序：栈区（stack）、堆区（heap）、全局区か静态区（static）、文字常量区、程序代码区
    - `段表`：实现逻址转物址
        - 逻辑地址は<`段号`, `段内偏移`>
        - `段表寄存器`存放段表基址と段表长度，段表には一组段长と段基址。段号太大（＞段表长度）か段内偏移太大（＞段长）なら`越界中断`；否则，段表中凭段号找段基址，加偏量得。
- 5.4 分页（paging）内存管理方案
    - 固定大小な帧（frame，物理内存）、页（page，程序の逻辑地址空间）という块
        - 帧、页同大小，皆 $2^k$ 字节
        - 免外部碎片
    - 地址转换：CPU 产两部分（页号、页偏移）
    - 页表：逻址到物址
    - 页大小：太大浪费（每进程平均半页内碎）太小页表过长，常4~8KB
    - 页表在内存，寄存器为`页表基址寄存器`、`页表长度寄存器`在PCB中，切换只改它们
    - `快表`
        - CPU的cache中有`转换表缓冲区`（`TLB`，translation look-aside buffer），放在TLB中的部分页表谓快表
        - TLB中查找时，同时与所有条目比较，没找到再找内存并放入TLB
        - 有的在TLB条目中有ASID标识进程，则切换不需改TLB
    - 用页号在TLB找，找不到在页表找，得到页基址，加偏移量得物址
    - 共享页：共享内存通信的一种实现
    - 分级页表：页表再分页，一个顶级页表，分到最后的页面大小等于内存帧
        - 栗子：32位系统，页4KB，则逻辑地址空间一共有$2^{32}B/4KB = 2^{20} = 1M$页，取页表项大小4B，需要占4MB的页表装下所有表项，装个屁。
            - 改用多级，x级，使每个页表有一页大。每页表项$4KB/4B = 2^{10}$，则要x次方不小于总页数，即$(2^{10})^x ≥ 2^{20}$，解得$x ≥ 2$，需要两级分页。
            - 64位的话，$2^{64}B/4KB = 2^{52}$页，$(2^{10})^x ≥ 2^{52}$得到$x≥6$，我觉得是6级页表，课件说7级？？？
    - 页内地址因为是后几位，同时页长$2^k$，因此最后几位是页内偏移不会溢出。但页号会越界吗，要检查吗？？？
- 段页式：程序分段，每段分页
    - 逻址は段号、页号、页内地址。

些题

- 给页长、页表，画出地址变换图以由逻址定物址：（转成二进制比较清楚）分原为表偏，表号共表首寻帧号，帧号加偏移得物址

# 章六 虚拟内存管理

# 章七 磁盘管理

# 章八 IO 系统

# 章九 文件系统
